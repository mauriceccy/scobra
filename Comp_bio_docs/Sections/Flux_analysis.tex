\chapter{Flux Analysis}

\section{Flux Balance Analysis (FBA)}

Scobra models can be used to simulate metabolism using flux balance analysis. For the sake of simplicity, all simulations here use the simple toy model shown in this figure:

\begin{figure}[h]
\centering
\includegraphics[height=4.5cm, width=5.5cm]{./img/Flux_analysis/scr_res.pdf}
\caption{Simple model}
\end{figure}

\begin{framed}
m = scobra.Model(`/home/user/toy.xml')
\end{framed}

%----------------------------------------------------------%

\subsection{Set flux bounds to the reactions}
Upper and lower limit of a reaction can be set using \textbf{SetConstraint} for a single reaction or \textbf{SetConstraints(}\textit{\{dict of reactions and flux bounds\}}).

\begin{framed}
$>>>$ m.SetConstraint('R1',0,10)\\
$>>>$ m.SetConstraints(\{'R2':(0,13),'R3':(0,30)\})
\end{framed}

%----------------------------------------------------------%
 \subsection{Set reaction ratios}
 
Constraints can also be applied using the \textbf{SetReactionFixedRatio} method. This constrains the ratio of flux between two or more reactions, and can be very useful for building a set of constraints. The method accepts as an argument a dictionary where they keys are reactions and the values are the respective flux ratios. For example,

\begin{framed}
$>>>$ m.SetReactionFixedRatio(\{ R1:1.5, R2: 2.2, R3: 0, $\cdots$ \})
\end{framed}

%----------------------------------------------------------%

\subsection{Set objective}
Suppose the objective is to calculate maximum growth rate in R7 and R8, i.e., maximizing \textit{Dex} and \textit{Eex} production. Objective reactions (reactions to minimize or maximize) and theire maximization or minimization can be set using \textbf{SetObjective} and \textbf{SetObjDirec}, respectively.

\begin{framed}
$>>>$ m.SetObjective(['R7','R8'])\\
$>>>$ m.SetObjDirec("Max'')
\end{framed}

%----------------------------------------------------------%

\subsection{Solving the Linear Programming (LP) problem}
The constraints based LP problem can be solved using \textbf{Solve()}. For this example, the method returns an optimal growth rate, i.e., a feasible solution. For problems which are not possible to solve, \textbf{Solve()} will give return "infeasible":

\begin{framed}
$>>>$ m.Solve()\\
optimal
\end{framed}

%----------------------------------------------------------%

\subsection{Solutions}
To get the flux solution as a dictionary use \textbf{GetSol}.

\begin{framed}
$>>>$ m.GetSol()\\
\{'R4': 10.0, 'R5': 3.0, 'R7': 10.0, 'R1': 10.0, 'R2': 13.0, $\cdots$\}
\end{framed}

%----------------------------------------------------------%

\subsection{Printing the solution}
\label{sec:print}

Flux distributions can also be obtained using \textbf{PrintSol}. For our example, the maximum growth rate (maximum possible flux under the input flux assumptions) for R7 and R8 are 10.0 and 3.0, respectively.

\begin{framed}
$>>>$ m.PrintSol()\\
R3: 19.0\\
R2: 13.0\\
R7: 10.0\\
R4: 10.0\\
R1: 10.0\\
R8: 3.0\\
R5: 3.0
\end{framed}

%----------------------------------------------------------%

\subsection{Fixing the flux}

Flux through a reaction can be fixed to a specific value using \textbf{SetFixedFlux}.

\begin{framed}
$>>>$ m.SetFixedFlux(\{'R1':0\})
\end{framed}

%----------------------------------------------------------%

\subsection{Get sum of fluxes}

Get the sum of fluxes for a metabolite using \textbf{FluxSum(}\textit{Metabolite}\textbf{)}.

\begin{framed}
$>>>$ m.FluxSum('E')\\
3.0\\

$>>>$ m.FluxSum('B')\\
13.0\\

$>>>$ m.FluxSum('C')\\ %Note the Flux obtained for `C'.
19.0
\end{framed}

%----------------------------------------------------------%

\subsection{Get constraints}

In order to manipulate the behaviour of the plants, certain constraints are applied which limit the direction and extent of a specific reaction. Use \textbf{GetConstraint(s)} to view these constraints.

\begin{framed}
$>>>$ m.GetConstraint('R1')\\
(0, 10)\\

$>>>$ m.GetConstraints()\\
\{'R4': (0.0, 1000.0), 'R5': (-1000.0, 1000.0), 'R6': (0.0, 1000.0), $\cdots$\}
\end{framed}

%----------------------------------------------------------%

\subsection{Summary information}
The basic information of a solution is obtained using the \textbf{GetState} method:

\begin{framed}
$>>>$ m.GetState()\\
\{'objective\_direction': 'maximize',\\
'solver': None,\\
'bounds': 1000.0,\\
'solution': $<$Solution 13.00 at 0xafdc7cc$>$,\\ 
'objective': \{'R4': 0.0, 'R5': 0.0, 'R6': 0.0, 'R7': 1, 'R1': 0.0, 'R2': 0.0, 'R3': 0.0, 'R8': 1\},\\
'quaduatic\_component': None,\\
'constraints': \{'R4': (0.0, 1000.0), 'R5': (-1000.0, 1000.0), $\cdots$\}\}
\end{framed}

%----------------------------------------------------------%

\subsection{Get flux range}

\begin{framed}
$>>>$ m.AllFluxRange()\\
\{'R4': (0.0, 10.0), 'R5': (0.0, 10.0), 'R6': (0.0, 0.0), 'R7': (0.0, 10.0), 'R1': (0.0, 10.0), 'R2': (0.0, 13.0), 'R3': (0.0, 30.0), 'R8': (0.0, 10.0)\}\\

$>>>$ m=scobra.Model('/home/user/toy.xml')\\
$>>>$ m.AllFluxRange()\\
\{'R4': (0.0, 1000.0), 'R5': (0.0, 333.33), 'R6': (0.0, 0.0), $\cdots$\}
\end{framed}

Note that the flux range is not equivalent to the constraints:

\begin{framed}
$>>>$ m.GetConstraints()\\
\{'R4': (0.0, 1000.0), 'R5': (-1000.0, 1000.0), 'R6': (0.0, 1000.0), $\cdots$\}
\end{framed}

%----------------------------------------------------------%

\section{Further Analysis}

\subsection{Flux Variability Analysis (FVA)}

When scobra returns a flux solution for a given model and set of parameters, this solution is rarely unique. Rather, each reaction can sustain a variety of fluxes as the other fluxes vary. The variation of possible fluxes through a reaction can be important information regarding the importance of different reactions within a particular solution: smaller variation suggests greater importance.\\

In order to determine these different fluxes, we use the method \textbf{FVA}, with arguments for the reactions for which you wish to see the flux variation (as a list) and the number of processes you would like to run.\\

The example below returns flux variability for the first 3 reactions in the model \textit model. It uses four processors to run the computation:

\begin{framed}
$>>>$ model.FVA(model.Reactions()[0:3], processes=4)
\end{framed}

The second example returns flux variability for the reactions in the list, using two processors:

\begin{framed}
$>>>$ model.FVA(reaclist=['R4', 'R5'], processes=2)
\end{framed}

%----------------------------------------------------------%





